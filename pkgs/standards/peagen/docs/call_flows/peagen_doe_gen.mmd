sequenceDiagram
    participant User
    participant CLI as peagen doe gen
    participant YAML as YAML Loader
    participant Schema as Schema Validator
    participant Publisher
    User ->> CLI: Run `peagen doe gen spec.yml template.yml -o project_payloads.yaml`
    CLI ->> YAML: Load DOE spec YAML and base template YAML
    CLI ->> Schema: Validate spec against DOE schema (unless --skip-validate)
    CLI ->> CLI: Compute design points (cartesian product of factors)
    CLI ->> CLI: For each design point: merge with base template, apply any patches
    CLI ->> YAML: Assemble `project_payloads.yaml` bundle with all PROJECTS
    CLI ->> User: List all design point IDs and factor values
    alt --dry-run option
        CLI -->> User: Outputs design matrix table (no file written)
    else 
        CLI ->> YAML: Write bundle to output file (or error if exists without --force)
        CLI -->> User: Prints success and file size
        opt if --notify specified
            CLI ->> Publisher: Instantiate publisher and publish "peagen.experiment.done" event
        end
    end

sequenceDiagram
    participant U as **User (builder)**
    participant DOE as **doe gen**
    participant FS as Builder FS
    participant PROC as **process**
    participant PE as Peagen Engine
    participant BK as Remote Bucket / Storage
    participant U2 as **User (evaluator)** 
    participant FETCH as **program fetch**
    participant FS2 as Eval FS
    participant EVAL as **peagen eval**
    participant POOL as Evaluator Pool
    
    %% DOE GEN on build machine
    U ->> DOE: `peagen doe gen spec.yml template.yml -o project_payloads.yaml`
    DOE ->> FS: project_payloads.yaml
    
    %% PROCESS on build machine
    U ->> PROC: `peagen process project_payloads.yaml --workspace-uri bk://run123/`
    PROC ->> PE: init(...)
    PE ->> FS: render files â†’ `/tmp/workspace`
    PE ->> BK: upload files & `run123_manifest.json`
    PROC -->> U: Manifest URI: `bk://run123/run123_manifest.json`
    
    %% program fetch on evaluation machine
    U2 ->> FETCH: `peagen program fetch bk://run123/run123_manifest.json -o ./workspace`
    FETCH ->> BK: download manifest & files
    FETCH ->> FS2: materialise `./workspace`
    FETCH -->> U2: Workspace reconstructed
    
    %% eval
    U2 ->> EVAL: `peagen eval ./workspace --pool DefaultEvaluatorPool --json`
    EVAL ->> POOL: evaluate_programs(programs)
    POOL -->> EVAL: results[]
    EVAL ->> FS2: write `./workspace/.peagen/eval_manifest.json`
    EVAL -->> U2: JSON manifest printed / file saved

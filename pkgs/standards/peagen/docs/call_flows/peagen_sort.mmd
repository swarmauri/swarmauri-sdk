sequenceDiagram
    participant User
    participant CLI as peagen sort
    participant Config as Config Loader
    participant Peagen as Peagen Engine
    participant Graph as DependencyGraph
    User ->> CLI: Run `peagen sort projects.yaml [options]`
    CLI ->> Config: load_peagen_toml() (load config for plugin mode, etc.)
    CLI ->> CLI: Resolve plugin mode and LLM API key (if provider specified)
    CLI ->> Peagen: Instantiate Peagen(dry_run=True) with projects file and env
    CLI ->> Peagen: Set log level based on -v flags:
    alt If --project-name is given
        CLI ->> Peagen: load_projects()
        Peagen -->> CLI: Returns list of projects
        CLI ->> Peagen: process_single_project(selected project, start_idx/file)
        Peagen -->> CLI: Returns sorted_records (file list)
        CLI ->> User: Print sorted file order for the project (index and filename)
        opt if --show-deps
            CLI ->> Graph: get_immediate_dependencies(record, file)
            Graph -->> CLI: Direct dependencies list
            CLI ->> User: Print dependencies for each file
        end
    else (All projects)
        CLI ->> Peagen: process_all_projects()
        Peagen -->> CLI: Returns sorted_records list per project
        CLI ->> User: For each project, print project name and its file sequence
    end
    CLI -->> User: Exit (0) after listing planned order

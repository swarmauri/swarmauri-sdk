var tt=Object.defineProperty;var nt=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var re=(e,t,n)=>nt(e,typeof t!="symbol"?t+"":t,n);function y(){}function fe(e,t){for(const n in t)e[n]=t[n];return e}function De(e){return e()}function _e(){return Object.create(null)}function x(e){e.forEach(De)}function A(e){return typeof e=="function"}function B(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ot(e){return Object.keys(e).length===0}function je(e,...t){if(e==null){for(const o of t)o(void 0);return y}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function R(e,t,n){e.$$.on_destroy.push(je(t,n))}function We(e,t,n,o){if(e){const s=qe(e,t,n,o);return e[0](s)}}function qe(e,t,n,o){return e[1]&&o?fe(n.ctx.slice(),e[1](o(t))):n.ctx}function He(e,t,n,o){if(e[2]&&o){const s=e[2](o(n));if(t.dirty===void 0)return s;if(typeof s=="object"){const i=[],c=Math.max(t.dirty.length,s.length);for(let r=0;r<c;r+=1)i[r]=t.dirty[r]|s[r];return i}return t.dirty|s}return t.dirty}function Be(e,t,n,o,s,i){if(s){const c=qe(t,n,o,i);e.p(c,s)}}function Ie(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function me(e){return e&&A(e.destroy)?e.destroy:y}function W(e,t){e.appendChild(t)}function S(e,t,n){e.insertBefore(t,n||null)}function k(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e){return document.createElement(e)}function pe(e){return document.createTextNode(e)}function z(){return pe(" ")}function te(){return pe("")}function st(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function L(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function it(e){return Array.from(e.childNodes)}function rt(e,t){t=""+t,e.data!==t&&(e.data=t)}function I(e,t,n,o){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,"")}function ge(e,t,n){e.classList.toggle(t,!!n)}function ye(e,t){return new e(t)}let Q;function J(e){Q=e}function Je(){if(!Q)throw new Error("Function called outside component initialization");return Q}function le(e,t){return Je().$$.context.set(e,t),t}function Ke(e){return Je().$$.context.get(e)}const U=[],be=[];let D=[];const ve=[],lt=Promise.resolve();let he=!1;function ct(){he||(he=!0,lt.then(ze))}function de(e){D.push(e)}const ce=new Set;let T=0;function ze(){if(T!==0)return;const e=Q;do{try{for(;T<U.length;){const t=U[T];T++,J(t),ut(t.$$)}}catch(t){throw U.length=0,T=0,t}for(J(null),U.length=0,T=0;be.length;)be.pop()();for(let t=0;t<D.length;t+=1){const n=D[t];ce.has(n)||(ce.add(n),n())}D.length=0}while(U.length);for(;ve.length;)ve.pop()();he=!1,ce.clear(),J(e)}function ut(e){if(e.fragment!==null){e.update(),x(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(de)}}function at(e){const t=[],n=[];D.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),D=t}const ee=new Set;let O;function V(){O={r:0,c:[],p:O}}function G(){O.r||x(O.c),O=O.p}function v(e,t){e&&e.i&&(ee.delete(e),e.i(t))}function w(e,t,n,o){if(e&&e.o){if(ee.has(e))return;ee.add(e),O.c.push(()=>{ee.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function ne(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ft(e,t){e.d(1),t.delete(e.key)}function ht(e,t){w(e,1,1,()=>{t.delete(e.key)})}function Qe(e,t,n,o,s,i,c,r,l,u,f,a){let d=e.length,h=i.length,m=d;const _={};for(;m--;)_[e[m].key]=m;const p=[],E=new Map,M=new Map,g=[];for(m=h;m--;){const b=a(s,i,m),P=n(b);let C=c.get(P);C?g.push(()=>C.p(b,t)):(C=u(P,b),C.c()),E.set(P,p[m]=C),P in _&&M.set(P,Math.abs(m-_[P]))}const X=new Set,N=new Set;function ie(b){v(b,1),b.m(r,f),c.set(b.key,b),f=b.first,h--}for(;d&&h;){const b=p[h-1],P=e[d-1],C=b.key,Z=P.key;b===P?(f=b.first,d--,h--):E.has(Z)?!c.has(C)||X.has(C)?ie(b):N.has(Z)?d--:M.get(C)>M.get(Z)?(N.add(C),ie(b)):(X.add(Z),d--):(l(P,c),d--)}for(;d--;){const b=e[d];E.has(b.key)||l(b,c)}for(;h;)ie(p[h-1]);return x(g),p}function we(e,t){const n={},o={},s={$$scope:1};let i=e.length;for(;i--;){const c=e[i],r=t[i];if(r){for(const l in c)l in r||(o[l]=1);for(const l in r)s[l]||(n[l]=r[l],s[l]=1);e[i]=r}else for(const l in c)s[l]=1}for(const c in o)c in n||(n[c]=void 0);return n}function ke(e){return typeof e=="object"&&e!==null?e:{}}function Y(e){e&&e.c()}function q(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),de(()=>{const i=e.$$.on_mount.map(De).filter(A);e.$$.on_destroy?e.$$.on_destroy.push(...i):x(i),e.$$.on_mount=[]}),s.forEach(de)}function H(e,t){const n=e.$$;n.fragment!==null&&(at(n.after_update),x(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function dt(e,t){e.$$.dirty[0]===-1&&(U.push(e),ct(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function oe(e,t,n,o,s,i,c=null,r=[-1]){const l=Q;J(e);const u=e.$$={fragment:null,ctx:[],props:i,update:y,not_equal:s,bound:_e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:_e(),dirty:r,skip_bound:!1,root:t.target||l.$$.root};c&&c(u.root);let f=!1;if(u.ctx=n?n(e,t.props||{},(a,d,...h)=>{const m=h.length?h[0]:d;return u.ctx&&s(u.ctx[a],u.ctx[a]=m)&&(!u.skip_bound&&u.bound[a]&&u.bound[a](m),f&&dt(e,a)),d}):[],u.update(),f=!0,x(u.before_update),u.fragment=o?o(u.ctx):!1,t.target){if(t.hydrate){const a=it(t.target);u.fragment&&u.fragment.l(a),a.forEach(k)}else u.fragment&&u.fragment.c();t.intro&&v(e.$$.fragment),q(e,t.target,t.anchor),ze()}J(l)}class se{constructor(){re(this,"$$");re(this,"$$set")}$destroy(){H(this,1),this.$destroy=y}$on(t,n){if(!A(n))return y;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!ot(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const mt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mt);const Ye=Symbol("layout-engine:manifest"),Ve=Symbol("layout-engine:registry"),pt=Symbol("layout-engine:mux");function _t(e){le(Ye,e.manifest),le(Ve,e.registry),e.mux&&le(pt,e.mux)}function Ge(){const e=Ke(Ye);if(!e)throw new Error("Layout manifest store not found; wrap content in LayoutEngineProvider.");return e}function gt(){const e=Ke(Ve);if(!e)throw new Error("Atom registry store not found; wrap content in LayoutEngineProvider.");return e}function yt(e){let t;const n=e[4].default,o=We(n,e,e[3],null);return{c(){o&&o.c()},m(s,i){o&&o.m(s,i),t=!0},p(s,[i]){o&&o.p&&(!t||i&8)&&Be(o,n,s,s[3],t?He(n,s[3],i,null):Ie(s[3]),null)},i(s){t||(v(o,s),t=!0)},o(s){w(o,s),t=!1},d(s){o&&o.d(s)}}}function bt(e,t,n){let{$$slots:o={},$$scope:s}=t,{manifest:i}=t,{registry:c}=t,{mux:r=void 0}=t;return _t({manifest:i,registry:c,mux:r}),e.$$set=l=>{"manifest"in l&&n(0,i=l.manifest),"registry"in l&&n(1,c=l.registry),"mux"in l&&n(2,r=l.mux),"$$scope"in l&&n(3,s=l.$$scope)},[i,c,r,s,o]}class vt extends se{constructor(t){super(),oe(this,t,bt,yt,B,{manifest:0,registry:1,mux:2})}}const F=[];function wt(e,t){return{subscribe:j(e,t).subscribe}}function j(e,t=y){let n;const o=new Set;function s(r){if(B(e,r)&&(e=r,n)){const l=!F.length;for(const u of o)u[1](),F.push(u,e);if(l){for(let u=0;u<F.length;u+=2)F[u][0](F[u+1]);F.length=0}}}function i(r){s(r(e))}function c(r,l=y){const u=[r,l];return o.add(u),o.size===1&&(n=t(s,i)||y),r(e),()=>{o.delete(u),o.size===0&&n&&(n(),n=null)}}return{set:s,update:i,subscribe:c}}function K(e,t,n){const o=!Array.isArray(e),s=o?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=t.length<2;return wt(n,(c,r)=>{let l=!1;const u=[];let f=0,a=y;const d=()=>{if(f)return;a();const m=t(o?u[0]:u,c,r);i?c(m):a=A(m)?m:y},h=s.map((m,_)=>je(m,p=>{u[_]=p,f&=~(1<<_),l&&d()},()=>{f|=1<<_}));return l=!0,d(),function(){x(h),a(),l=!1}})}function Se(e,t,n){const o=e.slice();return o[10]=t[n],o}function kt(e){return{c:y,m:y,p:y,i:y,o:y,d:y}}function St(e){let t=e[10].id,n,o,s=Ee(e);return{c(){s.c(),n=te()},m(i,c){s.m(i,c),S(i,n,c),o=!0},p(i,c){c&4&&B(t,t=i[10].id)?(V(),w(s,1,1,y),G(),s=Ee(i),s.c(),v(s,1),s.m(n.parentNode,n)):s.p(i,c)},i(i){o||(v(s),o=!0)},o(i){w(s),o=!1},d(i){i&&k(n),s.d(i)}}}function Ee(e){var u;let t,n,o,s,i;const c=[e[10].props];var r=(u=e[3].get(e[10].role))==null?void 0:u.component;function l(f,a){let d={};for(let h=0;h<c.length;h+=1)d=fe(d,c[h]);return a!==void 0&&a&4&&(d=fe(d,we(c,[ke(f[10].props)]))),{props:d}}return r&&(n=ye(r,l(e))),{c(){t=$("div"),n&&Y(n.$$.fragment),o=z(),L(t,"class","layout-engine-tile"),L(t,"style",s=e[8](e[10].frame))},m(f,a){S(f,t,a),n&&q(n,t,null),W(t,o),i=!0},p(f,a){var d;if(a&12&&r!==(r=(d=f[3].get(f[10].role))==null?void 0:d.component)){if(n){V();const h=n;w(h.$$.fragment,1,0,()=>{H(h,1)}),G()}r?(n=ye(r,l(f,a)),Y(n.$$.fragment),v(n.$$.fragment,1),q(n,t,o)):n=null}else if(r){const h=a&4?we(c,[ke(f[10].props)]):{};n.$set(h)}(!i||a&4&&s!==(s=f[8](f[10].frame)))&&L(t,"style",s)},i(f){i||(n&&v(n.$$.fragment,f),i=!0)},o(f){n&&w(n.$$.fragment,f),i=!1},d(f){f&&k(t),n&&H(n)}}}function Le(e,t){let n,o,s,i,c,r;const l=[St,kt],u=[];function f(a,d){return d&12&&(o=null),o==null&&(o=!!a[3].get(a[10].role)),o?0:1}return s=f(t,-1),i=u[s]=l[s](t),{key:e,first:null,c(){n=te(),i.c(),c=te(),this.first=n},m(a,d){S(a,n,d),u[s].m(a,d),S(a,c,d),r=!0},p(a,d){t=a;let h=s;s=f(t,d),s===h?u[s].p(t,d):(V(),w(u[h],1,1,()=>{u[h]=null}),G(),i=u[s],i?i.p(t,d):(i=u[s]=l[s](t),i.c()),v(i,1),i.m(c.parentNode,c))},i(a){r||(v(i),r=!0)},o(a){w(i),r=!1},d(a){a&&(k(n),k(c)),u[s].d(a)}}}function Et(e){let t,n=[],o=new Map,s,i=ne(e[2]);const c=r=>r[10].id;for(let r=0;r<i.length;r+=1){let l=Se(e,i,r),u=c(l);o.set(u,n[r]=Le(u,l))}return{c(){t=$("div");for(let r=0;r<n.length;r+=1)n[r].c();L(t,"class","layout-engine-view"),I(t,"position","relative"),I(t,"width",e[0]),I(t,"min-height",e[1])},m(r,l){S(r,t,l);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(t,null);s=!0},p(r,[l]){l&268&&(i=ne(r[2]),V(),n=Qe(n,l,c,1,r,i,o,t,ht,Le,null,Se),G()),(!s||l&1)&&I(t,"width",r[0]),(!s||l&2)&&I(t,"min-height",r[1])},i(r){if(!s){for(let l=0;l<i.length;l+=1)v(n[l]);s=!0}},o(r){for(let l=0;l<n.length;l+=1)w(n[l]);s=!1},d(r){r&&k(t);for(let l=0;l<n.length;l+=1)n[l].d()}}}function Lt(e,t,n){let o,s,i,c;const r=Ge(),l=gt();R(e,l,h=>n(3,c=h));const u=K(r,h=>h.tiles??[]);R(e,u,h=>n(2,i=h));const f=K(r,h=>{var m;return(m=h.viewport)!=null&&m.width?`${h.viewport.width}px`:"100%"});R(e,f,h=>n(0,o=h));const a=K(r,h=>{var m;return(m=h.viewport)!=null&&m.height?`${h.viewport.height}px`:"auto"});return R(e,a,h=>n(1,s=h)),[o,s,i,c,l,u,f,a,h=>h?`
      position:absolute;
      left:${h.x}px;
      top:${h.y}px;
      width:${h.w}px;
      height:${h.h}px;
      box-sizing:border-box;
      padding:12px;
      display:flex;
    `:""]}class Mt extends se{constructor(t){super(),oe(this,t,Lt,Et,B,{})}}function Pt(e){const t=e.site;return t?{pages:Array.isArray(t.pages)?t.pages.map(o=>({id:String((o==null?void 0:o.id)??""),route:String((o==null?void 0:o.route)??"/"),title:o!=null&&o.title?String(o.title):void 0,slots:Array.isArray(o==null?void 0:o.slots)?o==null?void 0:o.slots:void 0,meta:(o==null?void 0:o.meta)??void 0})):[],activePageId:t.active_page??(t==null?void 0:t.activePage),basePath:t.navigation&&typeof t.navigation=="object"?t.navigation.base_path:void 0}:{pages:[],activePageId:null,basePath:void 0}}function Ct(e){const t=j([]),n=j(null),o=j(void 0);return e.subscribe(i=>{const c=Pt(i);t.set(c.pages),n.set(c.activePageId??null),o.set(c.basePath)}),{pages:t,activePageId:n,basePath:o,navigate:i=>{let c=null;return t.update(r=>{const l=r.find(u=>u.id===i);return l&&(c=l.route),r}),c&&n.set(i),c}}}function Me(e,t,n){const o=e.slice();return o[11]=t[n],o}const $t=e=>({}),Pe=e=>({navigation:e[3],manifest:e[2]});function Ce(e){let t,n=[],o=new Map,s=ne(e[0]);const i=c=>c[11].id;for(let c=0;c<s.length;c+=1){let r=Me(e,s,c),l=i(r);o.set(l,n[c]=$e(l,r))}return{c(){t=$("nav");for(let c=0;c<n.length;c+=1)n[c].c();L(t,"class","layout-engine-shell__nav svelte-14fdevm")},m(c,r){S(c,t,r);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(t,null)},p(c,r){r&67&&(s=ne(c[0]),n=Qe(n,r,i,1,c,s,o,t,ft,$e,null,Me))},d(c){c&&k(t);for(let r=0;r<n.length;r+=1)n[r].d()}}}function $e(e,t){let n,o=(t[11].title??t[11].id)+"",s,i,c,r;function l(){return t[9](t[11])}return{key:e,first:null,c(){var u;n=$("button"),s=pe(o),i=z(),L(n,"type","button"),L(n,"class","svelte-14fdevm"),ge(n,"selected",t[11].id===((u=t[1])==null?void 0:u.id)),this.first=n},m(u,f){S(u,n,f),W(n,s),W(n,i),c||(r=st(n,"click",l),c=!0)},p(u,f){var a;t=u,f&1&&o!==(o=(t[11].title??t[11].id)+"")&&rt(s,o),f&3&&ge(n,"selected",t[11].id===((a=t[1])==null?void 0:a.id))},d(u){u&&k(n),c=!1,r()}}}function Nt(e){let t,n=e[0].length&&Ce(e);return{c(){n&&n.c(),t=te()},m(o,s){n&&n.m(o,s),S(o,t,s)},p(o,s){o[0].length?n?n.p(o,s):(n=Ce(o),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(o){o&&k(t),n&&n.d(o)}}}function Ot(e){let t,n,o,s;const i=e[8].default,c=We(i,e,e[7],Pe),r=c||Nt(e);return o=new Mt({}),{c(){t=$("div"),r&&r.c(),n=z(),Y(o.$$.fragment),L(t,"class","layout-engine-shell")},m(l,u){S(l,t,u),r&&r.m(t,null),W(t,n),q(o,t,null),s=!0},p(l,[u]){c?c.p&&(!s||u&128)&&Be(c,i,l,l[7],s?He(i,l[7],u,$t):Ie(l[7]),Pe):r&&r.p&&(!s||u&3)&&r.p(l,s?u:-1)},i(l){s||(v(r,l),v(o.$$.fragment,l),s=!0)},o(l){w(r,l),w(o.$$.fragment,l),s=!1},d(l){l&&k(t),r&&r.d(l),H(o)}}}function xt(e,t,n){let o,s,{$$slots:i={},$$scope:c}=t;const r=Ge(),l=Ct(r),u=l.pages;R(e,u,m=>n(0,o=m));const f=l.activePageId,a=K([u,f],([m,_])=>m.find(p=>p.id===_)??null);R(e,a,m=>n(1,s=m));const d=m=>{const _=l.navigate(m);_&&typeof window<"u"&&window.history.pushState({},"",_),typeof window<"u"&&window.dispatchEvent(new CustomEvent("layout-engine:navigate",{detail:{pageId:m}}))},h=m=>d(m.id);return e.$$set=m=>{"$$scope"in m&&n(7,c=m.$$scope)},[o,s,r,l,u,a,d,c,i,h]}class At extends se{constructor(t){super(),oe(this,t,xt,Ot,B,{})}}function Ne(e){let t,n,o,s;return{c(){t=$("div"),L(t,"class","le-shell__header")},m(i,c){S(i,t,c),o||(s=me(n=e[6].call(null,t,e[3])),o=!0)},p(i,c){n&&A(n.update)&&c&8&&n.update.call(null,i[3])},d(i){i&&k(t),o=!1,s()}}}function Tt(e){let t,n;return t=new At({}),{c(){Y(t.$$.fragment)},m(o,s){q(t,o,s),n=!0},p:y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){w(t.$$.fragment,o),n=!1},d(o){H(t,o)}}}function Ft(e){let t,n,o,s;return{c(){t=$("div"),L(t,"class","le-shell__content")},m(i,c){S(i,t,c),o||(s=me(n=e[6].call(null,t,e[4])),o=!0)},p(i,c){n&&A(n.update)&&c&16&&n.update.call(null,i[4])},i:y,o:y,d(i){i&&k(t),o=!1,s()}}}function Oe(e){let t,n,o,s;return{c(){t=$("div"),L(t,"class","le-shell__footer")},m(i,c){S(i,t,c),o||(s=me(n=e[6].call(null,t,e[5])),o=!0)},p(i,c){n&&A(n.update)&&c&32&&n.update.call(null,i[5])},d(i){i&&k(t),o=!1,s()}}}function Ut(e){let t,n,o,s,i,c,r=e[3]&&Ne(e);const l=[Ft,Tt],u=[];function f(d,h){return d[4]?0:1}o=f(e),s=u[o]=l[o](e);let a=e[5]&&Oe(e);return{c(){t=$("div"),r&&r.c(),n=z(),s.c(),i=z(),a&&a.c(),L(t,"class","le-shell-app svelte-18wyihj")},m(d,h){S(d,t,h),r&&r.m(t,null),W(t,n),u[o].m(t,null),W(t,i),a&&a.m(t,null),c=!0},p(d,h){d[3]?r?r.p(d,h):(r=Ne(d),r.c(),r.m(t,n)):r&&(r.d(1),r=null);let m=o;o=f(d),o===m?u[o].p(d,h):(V(),w(u[m],1,1,()=>{u[m]=null}),G(),s=u[o],s?s.p(d,h):(s=u[o]=l[o](d),s.c()),v(s,1),s.m(t,i)),d[5]?a?a.p(d,h):(a=Oe(d),a.c(),a.m(t,null)):a&&(a.d(1),a=null)},i(d){c||(v(s),c=!0)},o(d){w(s),c=!1},d(d){d&&k(t),r&&r.d(),u[o].d(),a&&a.d()}}}function Rt(e){let t,n;return t=new vt({props:{manifest:e[0],registry:e[1],mux:e[2],$$slots:{default:[Ut]},$$scope:{ctx:e}}}),{c(){Y(t.$$.fragment)},m(o,s){q(t,o,s),n=!0},p(o,[s]){const i={};s&1&&(i.manifest=o[0]),s&2&&(i.registry=o[1]),s&4&&(i.mux=o[2]),s&184&&(i.$$scope={dirty:s,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){w(t.$$.fragment,o),n=!1},d(o){H(t,o)}}}function Dt(e,t,n){let{manifestStore:o}=t,{registryStore:s}=t,{mux:i=void 0}=t,{headerSlot:c=null}=t,{contentSlot:r=null}=t,{footerSlot:l=null}=t;const u=(f,a)=>(f.innerHTML=a??"",{update(d){f.innerHTML=d??""},destroy(){f.innerHTML=""}});return e.$$set=f=>{"manifestStore"in f&&n(0,o=f.manifestStore),"registryStore"in f&&n(1,s=f.registryStore),"mux"in f&&n(2,i=f.mux),"headerSlot"in f&&n(3,c=f.headerSlot),"contentSlot"in f&&n(4,r=f.contentSlot),"footerSlot"in f&&n(5,l=f.footerSlot)},[o,s,i,c,r,l,u]}class jt extends se{constructor(t){super(),oe(this,t,Dt,Rt,B,{manifestStore:0,registryStore:1,mux:2,headerSlot:3,contentSlot:4,footerSlot:5})}}const ue=new Map,xe=new Map;async function Wt(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch manifest: ${t.status} ${t.statusText}`);return await t.json()}async function qt(e){if(!e.module)throw new Error(`Missing module specifier for atom ${e.role}`);const t=await import(e.module),n=e.export??"default";if(!(n in t))throw new Error(`Export '${n}' not found in module ${e.module}`);return t[n]}function Ht(e,t){var o;if(t)return t;const n=(o=e.meta)!=null&&o.atoms&&typeof e.meta.atoms=="object"?e.meta.atoms.revision:void 0;return String(n??e.etag??e.version??"default")}async function Xe(e,t={}){const n=t.fetcher??Wt,o=t.importResolver??qt,s=await n(e),i=Ht(s,t.cacheKey);if(ue.has(i)){const l=ue.get(i),u=xe.get(i)??new Map;return{manifest:l,components:u}}const c=new Map,r=s.tiles.map(l=>l.atom).filter(l=>!!(l&&l.family==="swarmakit"));for(const l of r){if(c.has(l.role))continue;const u=await o(l);c.set(l.role,{component:u,atom:l})}return ue.set(i,s),xe.set(i,c),{manifest:s,components:c}}function Bt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ze={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}Object.create&&(o.prototype=Object.create(null),new o().__proto__||(n=!1));function s(l,u,f){this.fn=l,this.context=u,this.once=f||!1}function i(l,u,f,a,d){if(typeof f!="function")throw new TypeError("The listener must be a function");var h=new s(f,a||l,d),m=n?n+u:u;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],h]:l._events[m].push(h):(l._events[m]=h,l._eventsCount++),l}function c(l,u){--l._eventsCount===0?l._events=new o:delete l._events[u]}function r(){this._events=new o,this._eventsCount=0}r.prototype.eventNames=function(){var u=[],f,a;if(this._eventsCount===0)return u;for(a in f=this._events)t.call(f,a)&&u.push(n?a.slice(1):a);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},r.prototype.listeners=function(u){var f=n?n+u:u,a=this._events[f];if(!a)return[];if(a.fn)return[a.fn];for(var d=0,h=a.length,m=new Array(h);d<h;d++)m[d]=a[d].fn;return m},r.prototype.listenerCount=function(u){var f=n?n+u:u,a=this._events[f];return a?a.fn?1:a.length:0},r.prototype.emit=function(u,f,a,d,h,m){var _=n?n+u:u;if(!this._events[_])return!1;var p=this._events[_],E=arguments.length,M,g;if(p.fn){switch(p.once&&this.removeListener(u,p.fn,void 0,!0),E){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,f),!0;case 3:return p.fn.call(p.context,f,a),!0;case 4:return p.fn.call(p.context,f,a,d),!0;case 5:return p.fn.call(p.context,f,a,d,h),!0;case 6:return p.fn.call(p.context,f,a,d,h,m),!0}for(g=1,M=new Array(E-1);g<E;g++)M[g-1]=arguments[g];p.fn.apply(p.context,M)}else{var X=p.length,N;for(g=0;g<X;g++)switch(p[g].once&&this.removeListener(u,p[g].fn,void 0,!0),E){case 1:p[g].fn.call(p[g].context);break;case 2:p[g].fn.call(p[g].context,f);break;case 3:p[g].fn.call(p[g].context,f,a);break;case 4:p[g].fn.call(p[g].context,f,a,d);break;default:if(!M)for(N=1,M=new Array(E-1);N<E;N++)M[N-1]=arguments[N];p[g].fn.apply(p[g].context,M)}}return!0},r.prototype.on=function(u,f,a){return i(this,u,f,a,!1)},r.prototype.once=function(u,f,a){return i(this,u,f,a,!0)},r.prototype.removeListener=function(u,f,a,d){var h=n?n+u:u;if(!this._events[h])return this;if(!f)return c(this,h),this;var m=this._events[h];if(m.fn)m.fn===f&&(!d||m.once)&&(!a||m.context===a)&&c(this,h);else{for(var _=0,p=[],E=m.length;_<E;_++)(m[_].fn!==f||d&&!m[_].once||a&&m[_].context!==a)&&p.push(m[_]);p.length?this._events[h]=p.length===1?p[0]:p:c(this,h)}return this},r.prototype.removeAllListeners=function(u){var f;return u?(f=n?n+u:u,this._events[f]&&c(this,f)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,r.EventEmitter=r,e.exports=r})(Ze);var It=Ze.exports;const Jt=Bt(It),Kt=1e3,zt=1e4,Qt=1.7;class Yt extends Jt{constructor(t){if(super(),this.socket=null,this.reconnectTimer=null,this.subscriptions=new Map,this.outboundQueue=[],this.handleOpen=()=>{this.emit("open"),this.reconnectDelay=this.options.reconnectDelay,this.flushQueue();for(const n of this.subscriptions.keys())this.enqueue({action:"subscribe",channel:n})},this.handleMessage=n=>{try{const o=JSON.parse(String(n.data));if(!o||typeof o!="object"||!("channel"in o)){this.emit("raw",o);return}const s=String(o.channel??"");if(!s)return;this.emit("message",o);const i=this.subscriptions.get(s);if(!i)return;const c={channel:s,payload:o.payload,...o};for(const r of i)r(c)}catch(o){this.emit("error",o)}},this.handleClose=()=>{this.emit("close"),this.scheduleReconnect()},this.handleError=n=>{this.emit("error",n)},!t.url)throw new Error("WSMuxClient requires a url");this.options={protocols:t.protocols??[],reconnectDelay:t.reconnectDelay??Kt,maxReconnectDelay:t.maxReconnectDelay??zt,backoffFactor:t.backoffFactor??Qt,url:t.url},this.reconnectDelay=this.options.reconnectDelay}connect(){this.socket&&(this.socket.readyState===WebSocket.OPEN||this.socket.readyState===WebSocket.CONNECTING)||(this.clearReconnect(),this.socket=new WebSocket(this.options.url,this.options.protocols),this.socket.addEventListener("open",this.handleOpen),this.socket.addEventListener("message",this.handleMessage),this.socket.addEventListener("close",this.handleClose),this.socket.addEventListener("error",this.handleError))}disconnect(){this.clearReconnect(),this.socket&&(this.socket.removeEventListener("open",this.handleOpen),this.socket.removeEventListener("message",this.handleMessage),this.socket.removeEventListener("close",this.handleClose),this.socket.removeEventListener("error",this.handleError),this.socket.close(),this.socket=null)}subscribe(t,n){return this.subscriptions.has(t)||(this.subscriptions.set(t,new Set),this.enqueue({action:"subscribe",channel:t})),this.subscriptions.get(t).add(n),this.connect(),()=>{const s=this.subscriptions.get(t);s&&(s.delete(n),s.size===0&&(this.subscriptions.delete(t),this.enqueue({action:"unsubscribe",channel:t})))}}publish(t,n){this.enqueue({action:"publish",channel:t,payload:n})}enqueue(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(this.outboundQueue.push(t),this.connect())}flushQueue(){var t;for(;this.outboundQueue.length;){const n=this.outboundQueue.shift();n&&((t=this.socket)==null||t.send(JSON.stringify(n)))}}scheduleReconnect(){this.clearReconnect(),this.reconnectTimer=setTimeout(()=>{this.connect(),this.reconnectDelay=Math.min(this.reconnectDelay*this.options.backoffFactor,this.options.maxReconnectDelay)},this.reconnectDelay)}clearReconnect(){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}}function Vt(e){const t=new Yt({url:e.muxUrl,protocols:e.protocols});return t.connect(),{client:t,channels:e.manifest.channels??[]}}async function Gt(e){const{manifest:t,components:n}=await Xe(e.manifestUrl),o=e.muxUrl?Vt({manifest:t,muxUrl:e.muxUrl,protocols:e.muxProtocols}):void 0,s=j(t),i=j(n),c=K(s,r=>r.tiles??[]);return{manifest:s,tiles:c,components:i,mux:o}}const Xt="le-shell-config",Zt="layout-engine:navigate",en="layout-engine:channel",ae=new Map;function tn(){const e=document.getElementById(Xt);if(!e)throw new Error("Missing layout engine config payload");return JSON.parse(e.textContent||"{}")}function Ae(e){return e?e.startsWith("ws://")||e.startsWith("wss://")?e:`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}${e.startsWith("/")?e:`/${e}`}`:null}function nn(e){const t=(e==null?void 0:e.pageParam)??"page",n=(e==null?void 0:e.defaultPageId)??null;return{manifestUrl:(e==null?void 0:e.manifestUrl)??"./manifest.json",pageParam:t,defaultPageId:n,history:(e==null?void 0:e.history)==="hash"?"hash":"history",enableMultipage:!!(e!=null&&e.enableMultipage||t||n),hydrateThemeFromManifest:(e==null?void 0:e.hydrateThemeFromManifest)??!0}}function et(e,t,n){if(!n.enableMultipage||!n.pageParam)return e;const[o,s=""]=e.split("?"),i=new URLSearchParams(s);t?i.set(n.pageParam,t):i.delete(n.pageParam);const c=i.toString();return c?`${o}?${c}`:o}function Te(e){return e.enableMultipage?e.history==="hash"?window.location.hash.replace(/^#/,"")||null:new URLSearchParams(window.location.search).get(e.pageParam)||null:null}function Fe(e,t,n){if(!e.enableMultipage)return;const o=(n==null?void 0:n.replace)??!1;if(e.history==="hash"){const i=t?`#${t}`:"";if(o){const c=`${window.location.pathname}${window.location.search}${i}`;window.history.replaceState({pageId:t},"",c)}else window.location.hash=i;return}const s=new URL(window.location.href);t?s.searchParams.set(e.pageParam,t):s.searchParams.delete(e.pageParam),o?window.history.replaceState({pageId:t},"",s):window.history.pushState({pageId:t},"",s)}function Ue(e){const t=typeof structuredClone=="function"?structuredClone(e.manifest):JSON.parse(JSON.stringify(e.manifest)),n=new Map(e.components);return{manifest:t,components:n}}async function Re(e,t){const n=t||"__default__";if(ae.has(n))return Ue(ae.get(n));const o=et(e.manifestUrl,t,e),s=await Xe(o),i={manifest:s.manifest,components:s.components};return ae.set(n,i),Ue(i)}async function on(){var f,a,d;const e=document.getElementById("le-app");if(!e)throw new Error("Unable to find mount element '#le-app'");const t=tn(),n=nn(t.router??{}),o=t.realtime??{},s=o.enabled?Ae(o.path):null,i=n.enableMultipage?Te(n)??n.defaultPageId:null,c=await Gt({manifestUrl:et(n.manifestUrl,i,n),muxUrl:s||void 0}),r=new jt({target:e,props:{manifestStore:c.manifest,registryStore:c.components,mux:c.mux,headerSlot:((f=t.ui)==null?void 0:f.headerSlot)??null,contentSlot:((a=t.ui)==null?void 0:a.contentSlot)??null,footerSlot:((d=t.ui)==null?void 0:d.footerSlot)??null}}),l=h=>{c.manifest.set(h.manifest),c.components.set(h.components)},u=async(h,m=!0)=>{const _=await Re(n,h);l(_),n.enableMultipage&&m&&Fe(n,h)};if(n.enableMultipage){const h=await Re(n,i);l(h),Fe(n,i,{replace:!0}),window.addEventListener(n.history==="hash"?"hashchange":"popstate",async()=>{const m=Te(n)??n.defaultPageId;await u(m,!1)}),window.addEventListener(Zt,async m=>{const _=m.detail||{};await u(_.pageId??null,!0)})}if(t.clientSetup)try{new Function("context",t.clientSetup)({config:t,manifest:c.manifest,registry:c.components})}catch(h){console.error("clientSetup execution failed",h)}if(o.enabled&&!c.mux){const h=Ae(o.path);if(h){const m=new WebSocket(h);m.addEventListener("open",()=>{if(o.autoSubscribe)for(const _ of o.channels??[])m.send(JSON.stringify({action:"subscribe",channel:_}))}),m.addEventListener("message",_=>{try{const p=JSON.parse(String(_.data));window.dispatchEvent(new CustomEvent(en,{detail:{channel:p.channel??null,payload:p.payload??null}}))}catch(p){console.warn("Unable to parse realtime payload",p)}})}}return r}on().catch(e=>{console.error("Failed to bootstrap Svelte runtime",e);typeof window!="undefined"&&window.dispatchEvent(new CustomEvent("layout-engine:svelte:fallback",{detail:{error:e}}));});
